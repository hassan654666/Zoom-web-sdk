<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Zoom Mobile Meeting</title>

    <!-- Zoom SDK dependencies -->
    <script src="https://source.zoom.us/3.12.0/lib/vendor/react.min.js"></script>
    <script src="https://source.zoom.us/3.12.0/lib/vendor/react-dom.min.js"></script>
    <script src="https://source.zoom.us/3.12.0/lib/vendor/redux.min.js"></script>
    <script src="https://source.zoom.us/3.12.0/lib/vendor/redux-thunk.min.js"></script>
    <script src="https://source.zoom.us/3.12.0/lib/vendor/lodash.min.js"></script>
    <script src="https://source.zoom.us/3.12.0/zoom-meeting-embedded-3.12.0.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <style>
      html, body {
        height: 100%;
        margin: 0;
        background: #000;
        overflow: hidden;
        font-family: "Inter", sans-serif;
      }

      /* Root meeting container */
      #meetingSDKElement {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100vw;
        background-color: #000;
        position: relative;
      }

      /* Participant video area */
      .participant-view {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      /* Fullscreen remote videos stacked */
      .remote-video {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #111;
      }

      video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 0;
      }

      /* Picture-in-picture for self-view */
      .pip-video {
        position: absolute;
        bottom: 15px;
        right: 15px;
        width: 110px;
        height: 160px;
        border-radius: 10px;
        overflow: hidden;
        border: 2px solid #fff;
        background: #222;
        z-index: 999;
      }

      /* Error and leave button */
      #error {
        color: #ff5252;
        text-align: center;
        font-size: 14px;
        margin-top: 15px;
      }

      #leaveBtn {
        position: absolute;
        top: 15px;
        left: 15px;
        background-color: #ff3b30;
        border: none;
        color: white;
        padding: 10px 18px;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        z-index: 1000;
        transition: background 0.2s;
      }

      #leaveBtn:hover {
        background-color: #ff5e57;
      }

      @media (max-width: 600px) {
        .pip-video {
          width: 90px;
          height: 130px;
        }
        #leaveBtn {
          padding: 8px 14px;
          font-size: 13px;
        }
      }
    </style>
  </head>

  <body>
    <button id="leaveBtn">Leave</button>
    <div id="meetingSDKElement"></div>
    <div id="error"></div>

    <script>
      window.addEventListener("DOMContentLoaded", async () => {
        const params = new URLSearchParams(window.location.search);
        const meetingNumber = params.get("meetingNumber");
        const signature = decodeURIComponent(params.get("signature") || "");
        const sdkKey = params.get("sdkKey");
        const userName = decodeURIComponent(params.get("name") || "Guest");
        const password = decodeURIComponent(params.get("password") || "").trim();

        if (!meetingNumber || !signature || !sdkKey) {
          document.getElementById("error").innerText = "❌ Missing parameters.";
          return;
        }

        try {
          const client = window.ZoomMtgEmbedded.createClient();
          const meetingSDKElement = document.getElementById("meetingSDKElement");

          await client.init({
            zoomAppRoot: meetingSDKElement,
            language: "en-US",
            customize: {
              video: {
                isResizable: false,
                viewSizes: {
                  default: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                  },
                },
              },
              layout: {
                mode: "gallery",
                popper: { disable: true },
              },
            },
          });

          await client.join({
            sdkKey,
            signature,
            meetingNumber,
            password,
            userName,
          });

          console.log("✅ Joined meeting successfully!");

          // Leave button to return to app
          document.getElementById("leaveBtn").addEventListener("click", () => {
            client.leaveMeeting().then(() => {
              window.location.href = "https://yourappdomain.com/exit-meeting"; // ⬅️ Replace with your app screen URL
            });
          });
        } catch (err) {
          console.error("❌ Join error:", err);
          document.getElementById("error").innerText =
            "❌ Failed to join meeting. See console for details.";
        }
      });
    </script>
  </body>
</html>
