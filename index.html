<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Zoom Meeting</title>

    <script src="https://source.zoom.us/2.18.0/lib/vendor/react.min.js"></script>
    <script src="https://source.zoom.us/2.18.0/lib/vendor/react-dom.min.js"></script>
    <script src="https://source.zoom.us/2.18.0/lib/vendor/redux.min.js"></script>
    <script src="https://source.zoom.us/2.18.0/lib/vendor/redux-thunk.min.js"></script>
    <script src="https://source.zoom.us/2.18.0/lib/vendor/lodash.min.js"></script>

    <script src="https://source.zoom.us/zoom-meeting-2.18.0.min.js"></script>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      /* Ensure zmmtg-root has dimensions for the meeting to render */
      #zmmtg-root {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>

  <body>
    <div id="zmmtg-root"></div>
    <div id="aria-notify-area"></div>

    <script>
      // FIX: Remove the DOMContentLoaded listener.
      // Since the script is at the end of the <body>, the DOM is guaranteed to be loaded.

      const params = new URLSearchParams(window.location.search);
      const meetingNumber = params.get("meetingNumber");
      const signature = params.get("signature");
      const sdkKey = params.get("sdkKey");
      const name = decodeURIComponent(params.get("name") || "Guest");
      const password = params.get("password") || ""; // Include password from URL

      if (!meetingNumber || !signature || !sdkKey) {
        document.body.innerHTML = `<p style="text-align:center;color:red;">Missing required URL parameters.</p>`;
        return;
      }

      console.log("ZoomMtg:", ZoomMtg);

      // üí° FIX 1: Set the library path first. This must be the very first call.
      ZoomMtg.setZoomJSLib("https://source.zoom.us/2.18.0/lib", "/av");
      
      // FIX 2: Pre-load and preparation calls are executed synchronously now.
      ZoomMtg.preLoadWasm();
      ZoomMtg.prepareJssdk();

      ZoomMtg.init({
        leaveUrl: window.location.origin,
        success: function () {
          console.log("‚úÖ Zoom SDK initialized");

          ZoomMtg.join({
            signature: signature,
            sdkKey: sdkKey,
            meetingNumber: meetingNumber,
            userName: name,
            password: password, // Pass the password variable
            success: () => console.log("‚úÖ Joined meeting successfully"),
            error: (err) => console.error("‚ùå Join error:", err),
          });
        },
        error: function (err) {
          console.error("‚ùå Init error:", err);
        },
      });
    </script>
  </body>
</html>